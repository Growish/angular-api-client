// Compiled Wed Jan 31 2018 12:11:59 GMT+0100 (CET)
angular.module("gwApiClient",[]).service("gwApi",["$q","$http","$timeout","$httpParamSerializerJQLike","$cacheFactory",function(e,t,a,d,n){var r,o=this,i=!1,s=n.get("$http"),l={env:"developing",baseUrl:"https://apidev.growish.com/v1",preserveUserSession:!0,localStorageFile:"gw-api-data"},u={};this.getBaseUrl=function(){return u.baseUrl};var c=function(e,t,a){this.name=e,this.endPoint=t,this.seed=void 0!==a?a:null,this.mapper={}};c.prototype.getEndPoint=function(e,t){var a=this.endPoint.replace(/{(\d+)}/g,function(t,a){return void 0!==e[a]?e[a]:t}),d="";for(var n in t)""!==d&&(d+="&"),d+=n+"="+t[n];return d?a+"?"+d:a};var p=new function(){var e=[];this.find=function(t){for(var a=0;a<e.length;a++)if(e[a].name===t)return e[a];return null},this.add=function(t,a,d){e.push(new c(t,a,d))}};p.add("auth","/auth/"),p.add("user","/user/{0}/"),p.add("newUser","/user/"),p.add("wallets","/user/{0}/wallet/"),p.add("listWallets","/user/{0}/list/"),p.add("listWallet.statement","/statement/{0}/"),p.add("newListWallet","/list/"),p.add("wallet","/wallet/{0}/"),p.add("newWallet","/wallet/"),p.add("list.product","/list/{0}/product/{1}/"),p.add("user.addressBook","/user/{0}/address-book/"),p.add("user.creditCard","/user/{0}/credit-card/"),p.add("parserExcel","/parserexcel/"),p.add("user.importAddressBook","/user/{0}/import-address-book/"),p.add("user.addressBookShare","/user/{0}/address-book-share/"),p.add("restorePassword","/passwordrecovery/"),p.add("setImageUser","/user/{0}/image/"),p.add("user.addChild","/user/{0}/add-child/"),p.add("user.updateAddressBook","/user/{0}/address-book/{1}/"),p.add("search.organization","/search/organization/"),p.add("newCommonFund","/common-fund-wallet/"),p.add("user.commonFunds","/user/{0}/common-fund-wallet/"),p.add("commonFund","/common-fund-wallet/{0}/"),p.add("closeCommonFundWallet","/close-common-fund-wallet/{0}/"),p.add("fee","/fee/"),p.add("setSchool","/school/"),p.add("closeWallet","/closewallet/"),p.add("cardContribution","/card_contribution/"),p.add("cashContribution","/cash_contribution/"),p.add("withdrawalContribution","/withdrawal_contribution/"),p.add("walletComment","/wallet/{0}/comment/"),p.add("updatePerks","/wallet/{0}/perk/{1}/"),p.add("user.notifications","/user/{0}/notification/"),p.add("notification","/checknoti/{0}/"),p.add("addPerk","/wallet/{0}/perk/"),p.add("statement","/statement/{0}/"),p.add("commonFundStatement","/commonfund-statement/{0}/"),p.add("walletInvite","/wallet/{0}/invite/"),p.add("beneficiary","/beneficiary/"),p.add("withdrawal","/withdrawal/"),p.add("setWalletImage","/wallet/{0}/image/"),p.add("business","/business/"),p.add("chargeWallet","/charge-wallet/"),p.add("transferContribution","/transfer_contribution/"),p.add("getList","/list/{0}/"),p.add("sendMoney","/transfer/"),p.add("checkContribution","/check-contribution/{0}/"),p.add("addressInvite","/wallet/{0}/address-invite/"),p.add("accessToken","/access-token/{0}/"),p.add("addNewProduct","/wallet/{0}/product/"),p.add("deleteProduct","/wallet/{0}/product/{1}/"),p.add("smsinvite","/smsinvite/"),p.add("giftCard","/giftcard/"),p.add("buyProduct","/buyproduct/"),p.add("fbAuth","/fbauth/"),p.add("agencyVisitNotification","/agency-visit-notification/"),p.add("blogPost","/blog-posts/"),p.add("userKycAuthentication","/user-kyc-authentication/"),p.add("saasPartner","/saas-partner/"),p.add("saasBusiness","/saas-business/"),p.add("preUser","/pre-user/"),p.add("downloadEbook","/download-ebook/"),p.add("feedaty","/feedaty/"),p.add("application","/application/"),p.add("agency","/agency/{0}/"),p.add("searchList","/list/"),p.add("agencySearchList","/agency/{0}/list/"),p.add("rsvp","/list/{0}/rsvp/"),p.add("listMessage","/list/{0}/message/"),p.add("fastAssistance","/fastassistance/"),p.add("onDemandHelp","/ondemandhelp/?mode=info"),p.add("getPdfStatement","/pdf-statement/{0}/"),p.add("changeRsvp","/changersvp/"),p.add("unseatUser","/unseatuser/"),p.add("seatUser","/seatuser/"),p.add("setGuest","/list/{0}/guest/"),p.add("requestRsvp","/rsvp/"),p.add("deletePeople","/delete-people/"),p.add("sendAdminMessage","/admin_msg/"),p.add("weddingPremiumProducts","/premium-products/?catalog=listanozze"),p.add("premiumProductSold","/premium-product-sold/"),p.add("table","/list/{0}/table/"),p.add("updateTable","/list/{0}/table/{1}/"),p.add("toDo","/list/{0}/todo/"),p.add("updateToDo","/list/{0}/todo/{1}/"),p.add("lastBeneficiary","/lastbeneficiary/{0}/"),p.add("pdfMessage","/list/{0}/pdf-message/"),p.add("walletProductPosition","/wallet-product-position/{0}/"),p.add("listDelete","/listdelete/"),p.add("list.image","/list/{0}/image/"),p.add("setListProduct","/list/{0}/product/"),p.add("agencyamount","/agencyamount/"),p.add("setGuests","/list/{0}/guests/"),p.add("setProductImage","/list/{0}/product/{1}/image/"),p.add("processPremiumProduct","/process-premium-product/{0}/"),p.add("newCart","/cart/"),p.add("cart.addProduct","/cart/{0}/product/"),p.add("cart","/cart/{0}/"),p.add("cart.product","/cart/{0}/product/{1}/"),p.add("buyPremiumProducts","/buy-premium-products/{0}/"),p.add("cart.voucher","/cart/{0}/voucher/"),p.add("product.comment","/product/{0}/comment/");var f=function(e,t){var a=this,d=!1;this.read=function(a,n){return new h(e,t,null,"GET",a,n,d)},this.save=function(a){return new h(e,t,a,"POST",null,null,d)},this.update=function(a){return new h(e,t,a,"PUT",null,null,d)},this.delete=function(){return new h(e,t,null,"DELETE",null,null,d)},this.setFullResponse=function(){return d=!0,a}},m=function(){this.code=-1,this.validationErrors={},this.validationErrorsFull={},this.handled=!1,this.message=null},h=function(n,o,i,l,c,p,f){var h,g=angular.copy(n),y=angular.copy(o);h=i&&"File"===i.constructor.name?i:angular.copy(i);var b=angular.copy(c),P=e.defer(),S=g.getEndPoint(y,b);if(h&&g.mapper.out&&(h=g.mapper.out(h)),g.seed)return w("Resolving "+S+" from seed"),a(function(){g.mapper.in?P.resolve(g.mapper.in(g.seed)):P.resolve(g.seed)},Math.floor(1e3*Math.random()+1e3)),P.promise;var C=[];C["Content-Type"]="application/x-www-form-urlencoded";var k=null;if(h&&"File"===h.constructor.name)C["Content-Type"]=void 0,(k=new FormData).append("0",h);else if(h&&"POST"===l){C["Content-Type"]=void 0,k=new FormData;for(var F in h)h.hasOwnProperty(F)&&(h[F]&&"File"===i[F].constructor.name?k.append(F,i[F]):void 0!==h[F]&&k.append(F,h[F]))}else h&&(k=d(h));C["X-App-Key"]=u.appKey,r&&r.token&&(C["X-Auth-Token"]=r.token);var T={cache:!1,method:l,data:k,url:u.baseUrl+S,headers:C,transformRequest:angular.identity};return"GET"===l&&"expired"===v.inCache(T.url)?(s.remove(T.url),w("Dropping cache for "+T.url)):"GET"===l&&"cached"===v.inCache(T.url)?(T.cache=!0,w("Cache found for "+T.url)):"GET"===l&&p&&(v.add(T.url,p),T.cache=!0,w("Caching "+T.url)),w(T),t(T).then(function(e){var t;t=f?{data:g.mapper.in?g.mapper.in(e.data.data):e.data.data,pagination:e.data.pagination,message:"string"==typeof e.data.message?e.data.message:null}:g.mapper.in?g.mapper.in(e.data.data):e.data.data,P.resolve(t)},function(e){var t=new m;t.code=e.status,400===e.status?(t.validationErrorsFull=e.data.message,angular.forEach(e.data.message,function(e,a){angular.forEach(e,function(e,d){t.validationErrors[a]=e})}),"function"==typeof u.error400&&(t.handled=!0,u.error400(t)),P.reject(t)):401===e.status&&"function"==typeof u.error401?(t.handled=!0,u.error401(e.data),P.reject(t)):403===e.status&&"function"==typeof u.error403?(t.handled=!0,t.message=e.data.message,u.error403(e.data),P.reject(t)):P.reject(t)}),P.promise},g=function(){r=null,localStorage.removeItem(u.localStorageFile)};this.updateSession=function(e){r.firstName=e.firstName,r.lastName=e.lastName,r.birthday=e.birthday,r.taxCode=e.taxCode,localStorage.setItem(u.localStorageFile,angular.toJson(r))},this.setSession=function(e){r=e,localStorage.setItem(u.localStorageFile,angular.toJson(e))},this.restoreSession=function(t,a){r={id:t,token:a};var d=e.defer();return o.request("user",r.id).read().then(function(e){o.setSession(e),d.resolve(e)},function(){o.dropSession(),d.reject()}),d.promise},this.session=function(t){if(void 0!==t&&t)return r;var a=e.defer();if(r)w("Session found in cache"),a.resolve(r);else{var d=localStorage.getItem(u.localStorageFile);d&&(d=angular.fromJson(d)),d&&d.id?(r=d,o.request("user",r.id).read().then(function(){w("Session found in local storage and validated in API"),a.resolve(r)},function(){w("Session found in local storage but invalidated in API"),localStorage.removeItem(u.localStorageFile),a.reject()})):(w("No session found"),a.reject())}return a.promise},this.logout=function(){var t=e.defer();return o.request("auth").delete().then(function(){t.resolve()},function(e){t.reject(e)}).finally(g),t.promise},this.dropSession=function(){g()},this.initialize=function(e){void 0===e.baseUrl&&void 0!==e.env&&"production"===e.env&&(e.baseUrl="https://api.growish.com/v1"),angular.extend(u,l,e),i=!0,w("I have been initialized with this config",u)},this.addSeed=function(e,t){var a=p.find(e);if(!a)return w("Method "+e+" is not defined."),!1;a.seed=t},this.request=function(){var e=arguments[0];if(!i)return w("You need to initialize the API client first"),!1;var t=p.find(e);if(!t)return w("Method "+e+" is not defined."),!1;for(var a=[],d=1;d<arguments.length;d++)a.push(arguments[d]);return new f(t,a)},this.authenticate=function(e,t){return o.request("auth").save({email:e,password:t})},this.addMapper=function(e,t){var a=p.find(e);return a?"function"!=typeof t.in||"function"!=typeof t.out?(w("The mapper object is not defined correctly"),!1):void(a.mapper=t):(w("Method "+e+" do not exist"),!1)},this.clearCache=function(){console.log(s.info()),s.removeAll(),console.log(s.info())};var v=new function(){var e=[],t=function(t){for(var a=0;a<e.length;a++)if(e[a].url===t)return a;return-1};this.clear=function(){e=[]},this.inCache=function(a){var d=(new Date).getTime(),n=t(a);return n>=0?!e[n].expire||e[n].expire<=d?(e.splice(n,1),"expired"):"cached":null},this.add=function(a,d){var n=(new Date).getTime(),r=t(a);return r>=0?e[r].expire>n||(e[r].expire=n+1e3*d,!0):(e.push({url:a,expire:n+1e3*d}),!0)}};this.flushCache=function(){return v.clear(),!0};var w=function(e,t){"production"!==u.env&&(console.log("***","GW API CLIENT:",e,"***"),t&&console.log(t))}}]);