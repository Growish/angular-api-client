// Compiled Mon Oct 09 2017 16:42:25 GMT+0200 (CEST)
angular.module("gwApiClient",[]).service("gwApi",["$q","$http","$timeout","$httpParamSerializerJQLike",function(e,t,a,r){var n,o=this,i=!1,d={env:"developing",baseUrl:"https://apidev.growish.com/v1",preserveUserSession:!0,localStorageFile:"gw-api-data"},s={};this.getBaseUrl=function(){return s.baseUrl};var l=function(e,t,a){this.name=e,this.endPoint=t,this.seed=void 0!==a?a:null,this.mapper={}};l.prototype.getEndPoint=function(e,t){var a=this.endPoint.replace(/{(\d+)}/g,function(t,a){return void 0!==e[a]?e[a]:t}),r="";for(var n in t)""!==r&&(r+="&"),r+=n+"="+t[n];return r?a+"?"+r:a};var u=new function(){var e=[];this.find=function(t){for(var a=0;a<e.length;a++)if(e[a].name===t)return e[a];return null},this.add=function(t,a,r){e.push(new l(t,a,r))}};u.add("auth","/auth/"),u.add("user","/user/{0}/"),u.add("newUser","/user/"),u.add("wallets","/user/{0}/wallet/"),u.add("listWallets","/user/{0}/list/"),u.add("listWallet.statement","/statement/{0}/"),u.add("newListWallet","/list/"),u.add("wallet","/wallet/{0}/"),u.add("newWallet","/wallet/"),u.add("list.product","/list/{0}/product/{1}/"),u.add("user.addressBook","/user/{0}/address-book/"),u.add("user.creditCard","/user/{0}/credit-card/"),u.add("parserExcel","/parserexcel/"),u.add("user.importAddressBook","/user/{0}/import-address-book/"),u.add("user.addressBookShare","/user/{0}/address-book-share/"),u.add("restorePassword","/passwordrecovery/"),u.add("setImageUser","/user/{0}/image/"),u.add("user.addChild","/user/{0}/add-child/"),u.add("user.updateAddressBook","/user/{0}/address-book/{1}/"),u.add("search.organization","/search/organization/"),u.add("newCommonFund","/common-fund-wallet/"),u.add("user.commonFunds","/user/{0}/common-fund-wallet/"),u.add("commonFund","/common-fund-wallet/{0}/"),u.add("closeCommonFundWallet","/close-common-fund-wallet/{0}/"),u.add("fee","/fee/"),u.add("setSchool","/school/"),u.add("closeWallet","/closewallet/"),u.add("cardContribution","/card_contribution/"),u.add("withdrawalContribution","/withdrawal_contribution/"),u.add("walletComment","/wallet/{0}/comment/"),u.add("updatePerks","/wallet/{0}/perk/{1}/"),u.add("user.notifications","/user/{0}/notification/"),u.add("notification","/checknoti/{0}/"),u.add("addPerk","/wallet/{0}/perk/"),u.add("statement","/statement/{0}/"),u.add("walletInvite","/wallet/{0}/invite/"),u.add("beneficiary","/beneficiary/"),u.add("withdrawal","/withdrawal/"),u.add("setWalletImage","/wallet/{0}/image/"),u.add("business","/business/"),u.add("chargeWallet","/charge-wallet/"),u.add("transferContribution","/transfer_contribution/");var c=function(e,t){this.read=function(a,r){return new h(e,t,null,"GET",a,r)},this.save=function(a){return new h(e,t,a,"POST",null,null)},this.update=function(a){return new h(e,t,a,"PUT",null,null)},this.delete=function(){return new h(e,t,null,"DELETE",null,null)}},f=function(){this.code=-1,this.validationErrors={},this.validationErrorsFull={},this.handled=!1,this.message=null},h=function(o,i,d,l,u,c){var h,v=angular.copy(o),g=angular.copy(i);h=d&&"File"===d.constructor.name?d:angular.copy(d);var w=angular.copy(u),b=e.defer(),S=v.getEndPoint(g,w);if(h&&v.mapper.out&&(h=v.mapper.out(h)),v.seed)return m("Resolving "+S+" from seed"),a(function(){v.mapper.in?b.resolve(v.mapper.in(v.seed)):b.resolve(v.seed)},Math.floor(1e3*Math.random()+1e3)),b.promise;var y=[];y["Content-Type"]="application/x-www-form-urlencoded";var k=null;h&&"File"===h.constructor.name?(y["Content-Type"]=void 0,(k=new FormData).append("0",h)):h&&(k=r(h)),y["X-App-Key"]=s.appKey,n&&n.token&&(y["X-Auth-Token"]=n.token);var C={cache:!1,method:l,data:k,url:s.baseUrl+S,headers:y,transformRequest:angular.identity};return"GET"===l&&p.inCache(C.url)&&(C.cache=!0,m("Pulling "+C.url+" from cache")),c&&p.add(C.url,c),t(C).then(function(e){v.mapper.in?b.resolve(v.mapper.in(e.data.data)):b.resolve(e.data.data)},function(e){var t=new f;t.code=e.status,400===e.status?(t.validationErrorsFull=e.data.message,angular.forEach(e.data.message,function(e,a){angular.forEach(e,function(e,r){t.validationErrors[a]=e})}),"function"==typeof s.error400&&(t.handled=!0,s.error400(t)),b.reject(t)):401===e.status&&"function"==typeof s.error401?(t.handled=!0,s.error401(e.data),b.reject(t)):403===e.status&&"function"==typeof s.error403?(t.handled=!0,t.message=e.data.message,s.error403(e.data),b.reject(t)):b.reject(t)}),b.promise};this.updateSession=function(e){n.firstName=e.firstName,n.lastName=e.lastName,n.birthday=e.birthday,n.taxCode=e.taxCode,localStorage.setItem(s.localStorageFile,angular.toJson(n))},this.setSession=function(e){n=e,localStorage.setItem(s.localStorageFile,angular.toJson(e))},this.session=function(t){if(void 0!==t&&t)return n;var a=e.defer();if(n)m("Session found in cache"),a.resolve(n);else{var r=localStorage.getItem(s.localStorageFile);r&&(r=angular.fromJson(r)),r&&r.id?(n=r,o.request("user",n.id).read().then(function(){m("Session found in local storage and validated in API"),a.resolve(n)},function(){m("Session found in local storage but invalidated in API"),localStorage.removeItem(s.localStorageFile),a.reject()})):(m("No session found"),a.reject())}return a.promise},this.logout=function(){var t=e.defer();return n=null,localStorage.removeItem(s.localStorageFile),o.request("auth").delete().then(function(){t.resolve()},function(e){t.reject(e)}),t.promise},this.initialize=function(e){void 0===e.baseUrl&&void 0!==e.env&&"production"===e.env&&(e.baseUrl="https://api.growish.com/v1"),angular.extend(s,d,e),i=!0,m("I have been initialized with this config",s)},this.addSeed=function(e,t){var a=u.find(e);if(!a)return m("Method "+e+" is not defined."),!1;a.seed=t},this.request=function(){var e=arguments[0];if(!i)return m("You need to initialize the API client first"),!1;var t=u.find(e);if(!t)return m("Method "+e+" is not defined."),!1;for(var a=[],r=1;r<arguments.length;r++)a.push(arguments[r]);return new c(t,a)},this.authenticate=function(e,t){return o.request("auth").save({email:e,password:t})},this.addMapper=function(e,t){var a=u.find(e);return a?"function"!=typeof t.in||"function"!=typeof t.out?(m("The mapper object is not defined correctly"),!1):void(a.mapper=t):(m("Method "+e+" do not exist"),!1)};var p=new function(){var e=[],t=function(t){for(var a=0;a<e.length;a++)if(e[a].url===t)return a;return-1};this.inCache=function(a){var r=(new Date).getTime(),n=t(a);return n>=0&&(!(!e[n].expire||e[n].expire<=r)||(e[n].expire=null,!1))},this.add=function(a,r){var n=(new Date).getTime(),o=t(a);return o>=0?(e[o].expire=n+1e3*r,!0):(e.push({url:a,expire:n}),!0)}},m=function(e,t){"production"!==s.env&&(console.log("***","GW API CLIENT:",e,"***"),t&&console.log(t))}}]);