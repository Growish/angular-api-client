// Compiled Tue Sep 05 2017 17:32:19 GMT+0200 (CEST)
angular.module("gwApiClient",[]).service("gwApi",["$q","$http","$timeout","$httpParamSerializerJQLike",function(e,t,n,r){var a,o=this,i=!1,s={env:"developing",baseUrl:"https://apidev.growish.com/v1",preserveUserSession:!0,localStorageFile:"gw-api-data"},u={},d=function(e,t,n){this.name=e,this.endPoint=t,this.seed=void 0!==n?n:null,this.mapper={}};d.prototype.getEndPoint=function(e,t){var n=this.endPoint.replace(/{(\d+)}/g,function(t,n){return void 0!==e[n]?e[n]:t}),r="";for(var a in t)""!==r&&(r+="&"),r+=a+"="+t[a];return r?n+"?"+r:n};var l=new function(){var e=[];this.find=function(t){for(var n=0;n<e.length;n++)if(e[n].name===t)return e[n];return null},this.add=function(t,n,r){e.push(new d(t,n,r))}};l.add("auth","/auth/"),l.add("user","/user/{0}/"),l.add("newUser","/user/"),l.add("wallets","/user/{0}/wallet/"),l.add("newListWallet","/list/"),l.add("wallet","/wallet/{0}/"),l.add("newWallet","/wallet/"),l.add("list.product","/list/{0}/product/{1}/"),l.add("user.addressBook","/user/{0}/address-book/"),l.add("user.creditCard","/user/{0}/credit-card/"),l.add("user.commonFund","/user/{0}/common-fund/"),l.add("parserExcel","/parserexcel/"),l.add("list.guests","/list/{0}/guests/"),l.add("user.addressBookShare","/user/{0}/address-book-share/"),l.add("restorePassword","/passwordrecovery/");var c=function(e,t){this.read=function(n,r){return new h(e,t,null,"GET",n,r)},this.save=function(n){return new h(e,t,n,"POST",null,null)},this.update=function(n){return new h(e,t,n,"PUT",null,null)},this.delete=function(){return new h(e,t,null,"DELETE",null,null)}},f=function(){this.code=-1,this.validationErrors={},this.handled=!1,this.message=null},h=function(o,i,s,d,l,c){var h=angular.copy(o),g=angular.copy(i),m=angular.copy(s),w=angular.copy(l),S=e.defer(),y=h.getEndPoint(g,w);if(m&&h.mapper.out&&(m=h.mapper.out(m)),h.seed)return v("Resolving "+y+" from seed"),n(function(){h.mapper.in?S.resolve(h.mapper.in(h.seed)):S.resolve(h.seed)},Math.floor(1e3*Math.random()+1e3)),S.promise;var E=[];E["X-App-Key"]=u.appKey,E["Content-Type"]="application/x-www-form-urlencoded",a&&a.token&&(E["X-Auth-Token"]=a.token);var P={cache:!1,method:d,data:m?r(m):null,url:u.baseUrl+y,headers:E,transformRequest:angular.identity};return"GET"===d&&p.inCache(P.url)&&(P.cache=!0,v("Pulling "+P.url+" from cache")),c&&p.add(P.url,c),t(P).then(function(e){h.mapper.in?S.resolve(h.mapper.in(e.data.data)):S.resolve(e.data.data)},function(e){var t=new f;t.code=e.status,400===e.status?(angular.forEach(e.data.message,function(e,n){angular.forEach(e,function(e,r){t.validationErrors[n]=e})}),"function"==typeof u.error400&&(t.handled=!0,u.error400(t)),S.reject(t)):401===e.status&&"function"==typeof u.error401?(t.handled=!0,u.error401(e.data),S.reject(t)):403===e.status&&"function"==typeof u.error403?(t.handled=!0,t.message=e.data.message,u.error403(e.data),S.reject(t)):S.reject(t)}),S.promise};this.updateSession=function(e){a.firstName=e.firstName,a.lastName=e.lastName,a.birthday=e.birthday,a.taxCode=e.taxCode,localStorage.setItem(u.localStorageFile,angular.toJson(a))},this.setSession=function(e){a=e,localStorage.setItem(u.localStorageFile,angular.toJson(e))},this.session=function(){var t=e.defer();if(a)v("Session found in cache"),t.resolve(a);else{var n=localStorage.getItem(u.localStorageFile);n&&(n=angular.fromJson(n)),n&&n.id?(a=n,o.request("user",a.id).read().then(function(){v("Session found in local storage and validated in API"),t.resolve(a)},function(){v("Session found in local storage but invalidated in API"),localStorage.removeItem(u.localStorageFile),t.reject()})):(v("No session found"),t.reject())}return t.promise},this.logout=function(){var t=e.defer();return o.request("auth").delete().then(function(){a=null,localStorage.removeItem(u.localStorageFile),t.resolve()},function(e){t.reject(e)}),t.promise},this.initialize=function(e){void 0===e.baseUrl&&void 0!==e.env&&"production"===e.env&&(e.baseUrl="https://api.growish.com/v1"),angular.extend(u,s,e),i=!0,v("I have been initialized with this config",u)},this.addSeed=function(e,t){var n=l.find(e);if(!n)return v("Method "+e+" is not defined."),!1;n.seed=t},this.request=function(){var e=arguments[0];if(!i)return v("You need to initialize the API client first"),!1;var t=l.find(e);if(!t)return v("Method "+e+" is not defined."),!1;for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);return new c(t,n)},this.authenticate=function(e,t){return o.request("auth").save({email:e,password:t})},this.addMapper=function(e,t){var n=l.find(e);return n?"function"!=typeof t.in||"function"!=typeof t.out?(v("The mapper object is not defined correctly"),!1):void(n.mapper=t):(v("Method "+e+" do not exist"),!1)};var p=new function(){var e=[],t=function(t){for(var n=0;n<e.length;n++)if(e[n].url===t)return n;return-1};this.inCache=function(n){var r=(new Date).getTime(),a=t(n);return console.table(e),a>=0&&(!(!e[a].expire||e[a].expire<=r)||(e[a].expire=null,!1))},this.add=function(n,r){var a=(new Date).getTime(),o=t(n);return o>=0?(e[o].expire=a+1e3*r,!0):(e.push({url:n,expire:a}),!0)}},v=function(e,t){"production"!==u.env&&console.log("***","GW API CLIENT:",e,"***"),t&&console.log(t)}}]);