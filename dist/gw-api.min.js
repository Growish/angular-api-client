// Compiled Tue Sep 12 2017 14:28:41 GMT+0200 (CEST)
angular.module("gwApiClient",[]).service("gwApi",["$q","$http","$timeout","$httpParamSerializerJQLike",function(e,t,r,n){var a,o=this,i=!1,s={env:"developing",baseUrl:"https://apidev.growish.com/v1",preserveUserSession:!0,localStorageFile:"gw-api-data"},d={};this.getBaseUrl=function(){return"developing"===d.env?"https://apidev.growish.com/v1":"https://api.growish.com/v1"};var u=function(e,t,r){this.name=e,this.endPoint=t,this.seed=void 0!==r?r:null,this.mapper={}};u.prototype.getEndPoint=function(e,t){var r=this.endPoint.replace(/{(\d+)}/g,function(t,r){return void 0!==e[r]?e[r]:t}),n="";for(var a in t)""!==n&&(n+="&"),n+=a+"="+t[a];return n?r+"?"+n:r};var l=new function(){var e=[];this.find=function(t){for(var r=0;r<e.length;r++)if(e[r].name===t)return e[r];return null},this.add=function(t,r,n){e.push(new u(t,r,n))}};l.add("auth","/auth/"),l.add("user","/user/{0}/"),l.add("newUser","/user/"),l.add("wallets","/user/{0}/wallet/"),l.add("listWallets","/user/{0}/list/"),l.add("listWallet.statement","/statement/{0}/"),l.add("newListWallet","/list/"),l.add("wallet","/wallet/{0}/"),l.add("newWallet","/wallet/"),l.add("list.product","/list/{0}/product/{1}/"),l.add("user.addressBook","/user/{0}/address-book/"),l.add("user.creditCard","/user/{0}/credit-card/"),l.add("user.commonFund","/user/{0}/common-fund/"),l.add("parserExcel","/parserexcel/"),l.add("user.importAddressBook","/user/{0}/import-address-book/"),l.add("user.addressBookShare","/user/{0}/address-book-share/"),l.add("restorePassword","/passwordrecovery/"),l.add("setImageUser","/user/{0}/image/"),l.add("user.addChild","/user/{0}/add-child/"),l.add("user.updateAddressBook","/user/{0}/address-book/{1}"),l.add("search.organization","/search/organization/");var c=function(e,t){this.read=function(r,n){return new h(e,t,null,"GET",r,n)},this.save=function(r){return new h(e,t,r,"POST",null,null)},this.update=function(r){return new h(e,t,r,"PUT",null,null)},this.delete=function(){return new h(e,t,null,"DELETE",null,null)}},f=function(){this.code=-1,this.validationErrors={},this.handled=!1,this.message=null},h=function(o,i,s,u,l,c){var h,m=angular.copy(o),g=angular.copy(i);h=s&&"File"===s.constructor.name?s:angular.copy(s);var w=angular.copy(l),S=e.defer(),y=m.getEndPoint(g,w);if(h&&m.mapper.out&&(h=m.mapper.out(h)),m.seed)return v("Resolving "+y+" from seed"),r(function(){m.mapper.in?S.resolve(m.mapper.in(m.seed)):S.resolve(m.seed)},Math.floor(1e3*Math.random()+1e3)),S.promise;var b=[];b["Content-Type"]="application/x-www-form-urlencoded";var E=null;h&&"File"===h.constructor.name?(b["Content-Type"]=void 0,(E=new FormData).append("0",h)):h&&(E=n(h)),b["X-App-Key"]=d.appKey,a&&a.token&&(b["X-Auth-Token"]=a.token);var P={cache:!1,method:u,data:E,url:d.baseUrl+y,headers:b,transformRequest:angular.identity};return"GET"===u&&p.inCache(P.url)&&(P.cache=!0,v("Pulling "+P.url+" from cache")),c&&p.add(P.url,c),t(P).then(function(e){m.mapper.in?S.resolve(m.mapper.in(e.data.data)):S.resolve(e.data.data)},function(e){var t=new f;t.code=e.status,400===e.status?(angular.forEach(e.data.message,function(e,r){angular.forEach(e,function(e,n){t.validationErrors[r]=e})}),"function"==typeof d.error400&&(t.handled=!0,d.error400(t)),S.reject(t)):401===e.status&&"function"==typeof d.error401?(t.handled=!0,d.error401(e.data),S.reject(t)):403===e.status&&"function"==typeof d.error403?(t.handled=!0,t.message=e.data.message,d.error403(e.data),S.reject(t)):S.reject(t)}),S.promise};this.updateSession=function(e){a.firstName=e.firstName,a.lastName=e.lastName,a.birthday=e.birthday,a.taxCode=e.taxCode,localStorage.setItem(d.localStorageFile,angular.toJson(a))},this.setSession=function(e){a=e,localStorage.setItem(d.localStorageFile,angular.toJson(e))},this.session=function(t){if(void 0!==t&&t)return a;var r=e.defer();if(a)v("Session found in cache"),r.resolve(a);else{var n=localStorage.getItem(d.localStorageFile);n&&(n=angular.fromJson(n)),n&&n.id?(a=n,o.request("user",a.id).read().then(function(){v("Session found in local storage and validated in API"),r.resolve(a)},function(){v("Session found in local storage but invalidated in API"),localStorage.removeItem(d.localStorageFile),r.reject()})):(v("No session found"),r.reject())}return r.promise},this.logout=function(){var t=e.defer();return o.request("auth").delete().then(function(){a=null,localStorage.removeItem(d.localStorageFile),t.resolve()},function(e){t.reject(e)}),t.promise},this.initialize=function(e){void 0===e.baseUrl&&void 0!==e.env&&"production"===e.env&&(e.baseUrl="https://api.growish.com/v1"),angular.extend(d,s,e),i=!0,v("I have been initialized with this config",d)},this.addSeed=function(e,t){var r=l.find(e);if(!r)return v("Method "+e+" is not defined."),!1;r.seed=t},this.request=function(){var e=arguments[0];if(!i)return v("You need to initialize the API client first"),!1;var t=l.find(e);if(!t)return v("Method "+e+" is not defined."),!1;for(var r=[],n=1;n<arguments.length;n++)r.push(arguments[n]);return new c(t,r)},this.authenticate=function(e,t){return o.request("auth").save({email:e,password:t})},this.addMapper=function(e,t){var r=l.find(e);return r?"function"!=typeof t.in||"function"!=typeof t.out?(v("The mapper object is not defined correctly"),!1):void(r.mapper=t):(v("Method "+e+" do not exist"),!1)};var p=new function(){var e=[],t=function(t){for(var r=0;r<e.length;r++)if(e[r].url===t)return r;return-1};this.inCache=function(r){var n=(new Date).getTime(),a=t(r);return console.table(e),a>=0&&(!(!e[a].expire||e[a].expire<=n)||(e[a].expire=null,!1))},this.add=function(r,n){var a=(new Date).getTime(),o=t(r);return o>=0?(e[o].expire=a+1e3*n,!0):(e.push({url:r,expire:a}),!0)}},v=function(e,t){"production"!==d.env&&console.log("***","GW API CLIENT:",e,"***"),t&&console.log(t)}}]);