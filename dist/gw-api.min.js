// Compiled Mon Sep 04 2017 14:54:38 GMT+0200 (CEST)
angular.module("gwApiClient",[]).service("gwApi",["$q","$http","$timeout","$httpParamSerializerJQLike",function(e,t,n,r){var a,i=this,o=!1,s={env:"developing",baseUrl:"https://apidev.growish.com/v1",preserveUserSession:!0,localStorageFile:"gw-api-data"},l={},u=function(e,t,n){this.name=e,this.endPoint=t,this.seed=void 0!==n?n:null,this.mapper={}};u.prototype.getEndPoint=function(e,t){var n=this.endPoint.replace(/{(\d+)}/g,function(t,n){return void 0!==e[n]?e[n]:t}),r="";for(var a in t)""!==r&&(r+="&"),r+=a+"="+t[a];return r?n+"?"+r:n};var d=new function(){var e=[];this.find=function(t){for(var n=0;n<e.length;n++)if(e[n].name===t)return e[n];return null},this.add=function(t,n,r){e.push(new u(t,n,r))}};d.add("auth","/auth/"),d.add("user","/user/{0}/"),d.add("newUser","/user/"),d.add("newListWallet","/list/"),d.add("wallet","/wallet/{0}/"),d.add("wallets","/user/{0}/wallet/"),d.add("newWallet","/wallet/"),d.add("list.product","/list/{0}/product/{1}/"),d.add("user.list","/user/{0}/list/{1}/"),d.add("user.addressBook","/user/{0}/address_book/"),d.add("user.creditCard","/user/{0}/credit_card/"),d.add("user.publicCollection","/user/{0}/public_collection/"),d.add("parserExcel","/parserexcel/"),d.add("list.guests","/list/{0}/guests/");var c=function(e,t){this.read=function(n,r){return new p(e,t,null,"GET",n,r)},this.save=function(n){return new p(e,t,n,"POST",null,null)},this.update=function(n){return new p(e,t,n,"PUT",null,null)},this.delete=function(){return new p(e,t,null,"DELETE",null,null)}},f=function(){this.code=-1,this.validationErrors={},this.handled=!1,this.message=null},p=function(i,o,s,u,d,c){var p=angular.copy(i),g=angular.copy(o),m=angular.copy(s),w=angular.copy(d),S=e.defer(),y=p.getEndPoint(g,w);if(m&&p.mapper.out&&(m=p.mapper.out(m)),p.seed)return v("Resolving "+y+" from seed"),n(function(){p.mapper.in?S.resolve(p.mapper.in(p.seed)):S.resolve(p.seed)},Math.floor(1e3*Math.random()+1e3)),S.promise;var E=[];E["X-App-Key"]=l.appKey,E["Content-Type"]="application/x-www-form-urlencoded",a&&a.token&&(E["X-Auth-Token"]=a.token);var P={cache:!1,method:u,data:m?r(m):null,url:l.baseUrl+y,headers:E,transformRequest:angular.identity};return"GET"===u&&h.inCache(P.url)&&(P.cache=!0,v("Pulling "+P.url+" from cache")),c&&h.add(P.url,c),t(P).then(function(e){p.mapper.in?S.resolve(p.mapper.in(e.data.data)):S.resolve(e.data.data)},function(e){var t=new f;t.code=e.status,400===e.status?(angular.forEach(e.data.message,function(e,n){angular.forEach(e,function(e,r){t.validationErrors[n]=e})}),"function"==typeof l.error400&&(t.handled=!0,l.error400(t)),S.reject(t)):401===e.status&&"function"==typeof l.error401?(t.handled=!0,l.error401(e.data),S.reject(t)):403===e.status&&"function"==typeof l.error403?(t.handled=!0,t.message=e.data.message,l.error403(e.data),S.reject(t)):S.reject(t)}),S.promise};this.setSession=function(e){a=e,localStorage.setItem(l.localStorageFile,angular.toJson(e))},this.session=function(){var t=e.defer();if(a)v("Session found in cache"),t.resolve(a);else{var n=localStorage.getItem(l.localStorageFile);n&&(n=angular.fromJson(n)),n&&n.id?(a=n,i.request("user",a.id).read().then(function(){v("Session found in local storage and validated in API"),t.resolve(a)},function(){v("Session found in local storage but invalidated in API"),localStorage.removeItem(l.localStorageFile),t.reject()})):(v("No session found"),t.reject())}return t.promise},this.logout=function(){var t=e.defer();return i.request("auth").delete().then(function(){a=null,localStorage.removeItem(l.localStorageFile),t.resolve()},function(e){t.reject(e)}),t.promise},this.initialize=function(e){void 0===e.baseUrl&&void 0!==e.env&&"production"===e.env&&(e.baseUrl="https://api.growish.com/v1"),angular.extend(l,s,e),o=!0,v("I have been initialized with this config",l)},this.addSeed=function(e,t){var n=d.find(e);if(!n)return v("Method "+e+" is not defined."),!1;n.seed=t},this.request=function(){var e=arguments[0];if(!o)return v("You need to initialize the API client first"),!1;var t=d.find(e);if(!t)return v("Method "+e+" is not defined."),!1;for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);return new c(t,n)},this.authenticate=function(e,t){return i.request("auth").save({email:e,password:t})},this.addMapper=function(e,t){var n=d.find(e);return n?"function"!=typeof t.in||"function"!=typeof t.out?(v("The mapper object is not defined correctly"),!1):void(n.mapper=t):(v("Method "+e+" do not exist"),!1)};var h=new function(){var e=[],t=function(t){for(var n=0;n<e.length;n++)if(e[n].url===t)return n;return-1};this.inCache=function(n){var r=(new Date).getTime(),a=t(n);return console.table(e),a>=0&&(!(!e[a].expire||e[a].expire<=r)||(e[a].expire=null,!1))},this.add=function(n,r){var a=(new Date).getTime(),i=t(n);return i>=0?(e[i].expire=a+1e3*r,!0):(e.push({url:n,expire:a}),!0)}},v=function(e,t){"production"!==l.env&&console.log("***","GW API CLIENT:",e,"***"),t&&console.log(t)}}]);