// Compiled Wed Dec 20 2017 17:33:04 GMT+0100 (CET)
angular.module("gwApiClient",[]).service("gwApi",["$q","$http","$timeout","$httpParamSerializerJQLike",function(e,a,t,n){var r,o=this,d=!1,i={env:"developing",baseUrl:"https://apidev.growish.com/v1",preserveUserSession:!0,localStorageFile:"gw-api-data"},s={};this.getBaseUrl=function(){return s.baseUrl};var l=function(e,a,t){this.name=e,this.endPoint=a,this.seed=void 0!==t?t:null,this.mapper={}};l.prototype.getEndPoint=function(e,a){var t=this.endPoint.replace(/{(\d+)}/g,function(a,t){return void 0!==e[t]?e[t]:a}),n="";for(var r in a)""!==n&&(n+="&"),n+=r+"="+a[r];return n?t+"?"+n:t};var u=new function(){var e=[];this.find=function(a){for(var t=0;t<e.length;t++)if(e[t].name===a)return e[t];return null},this.add=function(a,t,n){e.push(new l(a,t,n))}};u.add("auth","/auth/"),u.add("user","/user/{0}/"),u.add("newUser","/user/"),u.add("wallets","/user/{0}/wallet/"),u.add("listWallets","/user/{0}/list/"),u.add("listWallet.statement","/statement/{0}/"),u.add("newListWallet","/list/"),u.add("wallet","/wallet/{0}/"),u.add("newWallet","/wallet/"),u.add("list.product","/list/{0}/product/{1}/"),u.add("user.addressBook","/user/{0}/address-book/"),u.add("user.creditCard","/user/{0}/credit-card/"),u.add("parserExcel","/parserexcel/"),u.add("user.importAddressBook","/user/{0}/import-address-book/"),u.add("user.addressBookShare","/user/{0}/address-book-share/"),u.add("restorePassword","/passwordrecovery/"),u.add("setImageUser","/user/{0}/image/"),u.add("user.addChild","/user/{0}/add-child/"),u.add("user.updateAddressBook","/user/{0}/address-book/{1}/"),u.add("search.organization","/search/organization/"),u.add("newCommonFund","/common-fund-wallet/"),u.add("user.commonFunds","/user/{0}/common-fund-wallet/"),u.add("commonFund","/common-fund-wallet/{0}/"),u.add("closeCommonFundWallet","/close-common-fund-wallet/{0}/"),u.add("fee","/fee/"),u.add("setSchool","/school/"),u.add("closeWallet","/closewallet/"),u.add("cardContribution","/card_contribution/"),u.add("withdrawalContribution","/withdrawal_contribution/"),u.add("walletComment","/wallet/{0}/comment/"),u.add("updatePerks","/wallet/{0}/perk/{1}/"),u.add("user.notifications","/user/{0}/notification/"),u.add("notification","/checknoti/{0}/"),u.add("addPerk","/wallet/{0}/perk/"),u.add("statement","/statement/{0}/"),u.add("commonFundStatement","/commonfund-statement/{0}/"),u.add("walletInvite","/wallet/{0}/invite/"),u.add("beneficiary","/beneficiary/"),u.add("withdrawal","/withdrawal/"),u.add("setWalletImage","/wallet/{0}/image/"),u.add("business","/business/"),u.add("chargeWallet","/charge-wallet/"),u.add("transferContribution","/transfer_contribution/"),u.add("getList","/list/{0}/"),u.add("sendMoney","/transfer/"),u.add("checkContribution","/check-contribution/{0}/"),u.add("addressInvite","/wallet/{0}/address-invite/"),u.add("accessToken","/access-token/{0}/"),u.add("addNewProduct","/wallet/{0}/product/"),u.add("deleteProduct","/wallet/{0}/product/{1}/"),u.add("smsinvite","/smsinvite/"),u.add("giftCard","/giftcard/"),u.add("buyProduct","/buyproduct/"),u.add("fbAuth","/fbauth/"),u.add("agencyVisitNotification","/agency-visit-notification/"),u.add("blogPost","/blog-posts/"),u.add("userKycAuthentication","/user-kyc-authentication/"),u.add("saasPartner","/saas-partner/"),u.add("saasBusiness","/saas-business/"),u.add("preUser","/pre-user/"),u.add("downloadEbook","/download-ebook/"),u.add("feedaty","/feedaty/"),u.add("application","/application/"),u.add("agency","/agency/{0}/"),u.add("searchList","/list/"),u.add("agencySearchList","/agency/{0}/list/");var c=function(e,a){var t=this,n=!1;this.read=function(t,r){return new p(e,a,null,"GET",t,r,n)},this.save=function(t){return new p(e,a,t,"POST",null,null,n)},this.update=function(t){return new p(e,a,t,"PUT",null,null,n)},this.delete=function(){return new p(e,a,null,"DELETE",null,null,n)},this.setFullResponse=function(){return n=!0,t}},f=function(){this.code=-1,this.validationErrors={},this.validationErrorsFull={},this.handled=!1,this.message=null},p=function(o,d,i,l,u,c,p){var h,v=angular.copy(o),w=angular.copy(d);h=i&&"File"===i.constructor.name?i:angular.copy(i);var y=angular.copy(u),b=e.defer(),S=v.getEndPoint(w,y);if(h&&v.mapper.out&&(h=v.mapper.out(h)),v.seed)return g("Resolving "+S+" from seed"),t(function(){v.mapper.in?b.resolve(v.mapper.in(v.seed)):b.resolve(v.seed)},Math.floor(1e3*Math.random()+1e3)),b.promise;var k=[];k["Content-Type"]="application/x-www-form-urlencoded";var P=null;if(h&&"File"===h.constructor.name)k["Content-Type"]=void 0,(P=new FormData).append("0",h);else if(h&&"POST"===l){k["Content-Type"]=void 0,P=new FormData;for(var C in h)h.hasOwnProperty(C)&&(h[C]&&"File"===i[C].constructor.name?P.append(C,i[C]):void 0!==h[C]&&P.append(C,h[C]))}else h&&(P=n(h));k["X-App-Key"]=s.appKey,r&&r.token&&(k["X-Auth-Token"]=r.token);var F={cache:!1,method:l,data:P,url:s.baseUrl+S,headers:k,transformRequest:angular.identity};return"GET"===l&&m.inCache(F.url)&&(F.cache=!0,g("Pulling "+F.url+" from cache")),c&&m.add(F.url,c),g(F),a(F).then(function(e){var a;a=p?{data:v.mapper.in?v.mapper.in(e.data.data):e.data.data,pagination:e.data.pagination,message:"string"==typeof e.data.message?e.data.message:null}:v.mapper.in?v.mapper.in(e.data.data):e.data.data,b.resolve(a)},function(e){var a=new f;a.code=e.status,400===e.status?(a.validationErrorsFull=e.data.message,angular.forEach(e.data.message,function(e,t){angular.forEach(e,function(e,n){a.validationErrors[t]=e})}),"function"==typeof s.error400&&(a.handled=!0,s.error400(a)),b.reject(a)):401===e.status&&"function"==typeof s.error401?(a.handled=!0,s.error401(e.data),b.reject(a)):403===e.status&&"function"==typeof s.error403?(a.handled=!0,a.message=e.data.message,s.error403(e.data),b.reject(a)):b.reject(a)}),b.promise},h=function(){r=null,localStorage.removeItem(s.localStorageFile)};this.updateSession=function(e){r.firstName=e.firstName,r.lastName=e.lastName,r.birthday=e.birthday,r.taxCode=e.taxCode,localStorage.setItem(s.localStorageFile,angular.toJson(r))},this.setSession=function(e){r=e,localStorage.setItem(s.localStorageFile,angular.toJson(e))},this.session=function(a){if(void 0!==a&&a)return r;var t=e.defer();if(r)g("Session found in cache"),t.resolve(r);else{var n=localStorage.getItem(s.localStorageFile);n&&(n=angular.fromJson(n)),n&&n.id?(r=n,o.request("user",r.id).read().then(function(){g("Session found in local storage and validated in API"),t.resolve(r)},function(){g("Session found in local storage but invalidated in API"),localStorage.removeItem(s.localStorageFile),t.reject()})):(g("No session found"),t.reject())}return t.promise},this.logout=function(){var a=e.defer();return o.request("auth").delete().then(function(){a.resolve()},function(e){a.reject(e)}).finally(h),a.promise},this.dropSession=function(){h()},this.initialize=function(e){void 0===e.baseUrl&&void 0!==e.env&&"production"===e.env&&(e.baseUrl="https://api.growish.com/v1"),angular.extend(s,i,e),d=!0,g("I have been initialized with this config",s)},this.addSeed=function(e,a){var t=u.find(e);if(!t)return g("Method "+e+" is not defined."),!1;t.seed=a},this.request=function(){var e=arguments[0];if(!d)return g("You need to initialize the API client first"),!1;var a=u.find(e);if(!a)return g("Method "+e+" is not defined."),!1;for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);return new c(a,t)},this.authenticate=function(e,a){return o.request("auth").save({email:e,password:a})},this.addMapper=function(e,a){var t=u.find(e);return t?"function"!=typeof a.in||"function"!=typeof a.out?(g("The mapper object is not defined correctly"),!1):void(t.mapper=a):(g("Method "+e+" do not exist"),!1)};var m=new function(){var e=[],a=function(a){for(var t=0;t<e.length;t++)if(e[t].url===a)return t;return-1};this.clear=function(){e=[]},this.inCache=function(t){var n=(new Date).getTime(),r=a(t);return r>=0&&(!(!e[r].expire||e[r].expire<=n)||(e[r].expire=null,!1))},this.add=function(t,n){var r=(new Date).getTime(),o=a(t);return o>=0?e[o].expire>r||(e[o].expire=r+1e3*n,!0):(e.push({url:t,expire:r+1e3*n}),!0)}};this.flushCache=function(){return m.clear(),!0};var g=function(e,a){"production"!==s.env&&(console.log("***","GW API CLIENT:",e,"***"),a&&console.log(a))}}]);