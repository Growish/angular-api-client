// Compiled Tue Dec 12 2017 11:02:05 GMT+0100 (CET)
angular.module("gwApiClient",[]).service("gwApi",["$q","$http","$timeout","$httpParamSerializerJQLike",function(e,t,a,n){var r,o=this,i=!1,d={env:"developing",baseUrl:"https://apidev.growish.com/v1",preserveUserSession:!0,localStorageFile:"gw-api-data"},s={};this.getBaseUrl=function(){return s.baseUrl};var l=function(e,t,a){this.name=e,this.endPoint=t,this.seed=void 0!==a?a:null,this.mapper={}};l.prototype.getEndPoint=function(e,t){var a=this.endPoint.replace(/{(\d+)}/g,function(t,a){return void 0!==e[a]?e[a]:t}),n="";for(var r in t)""!==n&&(n+="&"),n+=r+"="+t[r];return n?a+"?"+n:a};var u=new function(){var e=[];this.find=function(t){for(var a=0;a<e.length;a++)if(e[a].name===t)return e[a];return null},this.add=function(t,a,n){e.push(new l(t,a,n))}};u.add("auth","/auth/"),u.add("user","/user/{0}/"),u.add("newUser","/user/"),u.add("wallets","/user/{0}/wallet/"),u.add("listWallets","/user/{0}/list/"),u.add("listWallet.statement","/statement/{0}/"),u.add("newListWallet","/list/"),u.add("wallet","/wallet/{0}/"),u.add("newWallet","/wallet/"),u.add("list.product","/list/{0}/product/{1}/"),u.add("user.addressBook","/user/{0}/address-book/"),u.add("user.creditCard","/user/{0}/credit-card/"),u.add("parserExcel","/parserexcel/"),u.add("user.importAddressBook","/user/{0}/import-address-book/"),u.add("user.addressBookShare","/user/{0}/address-book-share/"),u.add("restorePassword","/passwordrecovery/"),u.add("setImageUser","/user/{0}/image/"),u.add("user.addChild","/user/{0}/add-child/"),u.add("user.updateAddressBook","/user/{0}/address-book/{1}/"),u.add("search.organization","/search/organization/"),u.add("newCommonFund","/common-fund-wallet/"),u.add("user.commonFunds","/user/{0}/common-fund-wallet/"),u.add("commonFund","/common-fund-wallet/{0}/"),u.add("closeCommonFundWallet","/close-common-fund-wallet/{0}/"),u.add("fee","/fee/"),u.add("setSchool","/school/"),u.add("closeWallet","/closewallet/"),u.add("cardContribution","/card_contribution/"),u.add("withdrawalContribution","/withdrawal_contribution/"),u.add("walletComment","/wallet/{0}/comment/"),u.add("updatePerks","/wallet/{0}/perk/{1}/"),u.add("user.notifications","/user/{0}/notification/"),u.add("notification","/checknoti/{0}/"),u.add("addPerk","/wallet/{0}/perk/"),u.add("statement","/statement/{0}/"),u.add("commonFundStatement","/commonfund-statement/{0}/"),u.add("walletInvite","/wallet/{0}/invite/"),u.add("beneficiary","/beneficiary/"),u.add("withdrawal","/withdrawal/"),u.add("setWalletImage","/wallet/{0}/image/"),u.add("business","/business/"),u.add("chargeWallet","/charge-wallet/"),u.add("transferContribution","/transfer_contribution/"),u.add("getList","/list/{0}/"),u.add("sendMoney","/transfer/"),u.add("checkContribution","/check-contribution/{0}/"),u.add("addressInvite","/wallet/{0}/address-invite/"),u.add("accessToken","/access-token/{0}/"),u.add("addNewProduct","/wallet/{0}/product/"),u.add("deleteProduct","/wallet/{0}/product/{1}/"),u.add("smsinvite","/smsinvite/"),u.add("giftCard","/giftcard/"),u.add("buyProduct","/buyproduct/"),u.add("fbAuth","/fbauth/"),u.add("agencyVisitNotification","/agency-visit-notification/"),u.add("blogPost","/blog-posts/"),u.add("userKycAuthentication","/user-kyc-authentication"),u.add("saasPartner","/saas-partner/"),u.add("saasBusiness","/saas-business/"),u.add("preUser","/pre-user/"),u.add("downloadEbook","/download-ebook/");var c=function(e,t){var a=this,n=!1;this.read=function(a,r){return new h(e,t,null,"GET",a,r,n)},this.save=function(a){return new h(e,t,a,"POST",null,null,n)},this.update=function(a){return new h(e,t,a,"PUT",null,null,n)},this.delete=function(){return new h(e,t,null,"DELETE",null,null,n)},this.setFullResponse=function(){return n=!0,a}},f=function(){this.code=-1,this.validationErrors={},this.validationErrorsFull={},this.handled=!1,this.message=null},h=function(o,i,d,l,u,c,h){var p,g=angular.copy(o),w=angular.copy(i);d&&"File"===d.constructor.name?p=d:d&&void 0!==d.file&&"File"===d.file.constructor.name?(p=angular.copy(d)).file=d.file:p=angular.copy(d);var b=angular.copy(u),y=e.defer(),k=g.getEndPoint(w,b);if(p&&g.mapper.out&&(p=g.mapper.out(p)),g.seed)return v("Resolving "+k+" from seed"),a(function(){g.mapper.in?y.resolve(g.mapper.in(g.seed)):y.resolve(g.seed)},Math.floor(1e3*Math.random()+1e3)),y.promise;var S=[];S["Content-Type"]="application/x-www-form-urlencoded";var P=null;if(p&&"File"===p.constructor.name)S["Content-Type"]=void 0,(P=new FormData).append("0",p);else if(p&&void 0!==p.file&&"File"===p.file.constructor.name){S["Content-Type"]=void 0,P=new FormData;for(var C in p)p.hasOwnProperty(C)&&P.append(C,p[C])}else p&&(P=n(p));S["X-App-Key"]=s.appKey,r&&r.token&&(S["X-Auth-Token"]=r.token);var F={cache:!1,method:l,data:P,url:s.baseUrl+k,headers:S,transformRequest:angular.identity};return"GET"===l&&m.inCache(F.url)&&(F.cache=!0,v("Pulling "+F.url+" from cache")),c&&m.add(F.url,c),v(F),t(F).then(function(e){var t;t=h?{data:g.mapper.in?g.mapper.in(e.data.data):e.data.data,pagination:e.data.pagination,message:"string"==typeof e.data.message?e.data.message:null}:g.mapper.in?g.mapper.in(e.data.data):e.data.data,y.resolve(t)},function(e){var t=new f;t.code=e.status,400===e.status?(t.validationErrorsFull=e.data.message,angular.forEach(e.data.message,function(e,a){angular.forEach(e,function(e,n){t.validationErrors[a]=e})}),"function"==typeof s.error400&&(t.handled=!0,s.error400(t)),y.reject(t)):401===e.status&&"function"==typeof s.error401?(t.handled=!0,s.error401(e.data),y.reject(t)):403===e.status&&"function"==typeof s.error403?(t.handled=!0,t.message=e.data.message,s.error403(e.data),y.reject(t)):y.reject(t)}),y.promise},p=function(){r=null,localStorage.removeItem(s.localStorageFile)};this.updateSession=function(e){r.firstName=e.firstName,r.lastName=e.lastName,r.birthday=e.birthday,r.taxCode=e.taxCode,localStorage.setItem(s.localStorageFile,angular.toJson(r))},this.setSession=function(e){r=e,localStorage.setItem(s.localStorageFile,angular.toJson(e))},this.session=function(t){if(void 0!==t&&t)return r;var a=e.defer();if(r)v("Session found in cache"),a.resolve(r);else{var n=localStorage.getItem(s.localStorageFile);n&&(n=angular.fromJson(n)),n&&n.id?(r=n,o.request("user",r.id).read().then(function(){v("Session found in local storage and validated in API"),a.resolve(r)},function(){v("Session found in local storage but invalidated in API"),localStorage.removeItem(s.localStorageFile),a.reject()})):(v("No session found"),a.reject())}return a.promise},this.logout=function(){var t=e.defer();return o.request("auth").delete().then(function(){t.resolve()},function(e){t.reject(e)}).finally(p),t.promise},this.dropSession=function(){p()},this.initialize=function(e){void 0===e.baseUrl&&void 0!==e.env&&"production"===e.env&&(e.baseUrl="https://api.growish.com/v1"),angular.extend(s,d,e),i=!0,v("I have been initialized with this config",s)},this.addSeed=function(e,t){var a=u.find(e);if(!a)return v("Method "+e+" is not defined."),!1;a.seed=t},this.request=function(){var e=arguments[0];if(!i)return v("You need to initialize the API client first"),!1;var t=u.find(e);if(!t)return v("Method "+e+" is not defined."),!1;for(var a=[],n=1;n<arguments.length;n++)a.push(arguments[n]);return new c(t,a)},this.authenticate=function(e,t){return o.request("auth").save({email:e,password:t})},this.addMapper=function(e,t){var a=u.find(e);return a?"function"!=typeof t.in||"function"!=typeof t.out?(v("The mapper object is not defined correctly"),!1):void(a.mapper=t):(v("Method "+e+" do not exist"),!1)};var m=new function(){var e=[],t=function(t){for(var a=0;a<e.length;a++)if(e[a].url===t)return a;return-1};this.clear=function(){e=[]},this.inCache=function(a){var n=(new Date).getTime(),r=t(a);return r>=0&&(!(!e[r].expire||e[r].expire<=n)||(e[r].expire=null,!1))},this.add=function(a,n){var r=(new Date).getTime(),o=t(a);return o>=0?e[o].expire>r||(e[o].expire=r+1e3*n,!0):(e.push({url:a,expire:r+1e3*n}),!0)}};this.flushCache=function(){return m.clear(),!0};var v=function(e,t){"production"!==s.env&&(console.log("***","GW API CLIENT:",e,"***"),t&&console.log(t))}}]);