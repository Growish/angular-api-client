// Compiled Tue Sep 19 2017 18:50:18 GMT+0200 (CEST)
angular.module("gwApiClient",[]).service("gwApi",["$q","$http","$timeout","$httpParamSerializerJQLike",function(e,t,n,a){var r,o=this,i=!1,d={env:"developing",baseUrl:"https://apidev.growish.com/v1",preserveUserSession:!0,localStorageFile:"gw-api-data"},s={};this.getBaseUrl=function(){return"developing"===s.env?"https://apidev.growish.com/v1":"https://api.growish.com/v1"};var l=function(e,t,n){this.name=e,this.endPoint=t,this.seed=void 0!==n?n:null,this.mapper={}};l.prototype.getEndPoint=function(e,t){var n=this.endPoint.replace(/{(\d+)}/g,function(t,n){return void 0!==e[n]?e[n]:t}),a="";for(var r in t)""!==a&&(a+="&"),a+=r+"="+t[r];return a?n+"?"+a:n};var u=new function(){var e=[];this.find=function(t){for(var n=0;n<e.length;n++)if(e[n].name===t)return e[n];return null},this.add=function(t,n,a){e.push(new l(t,n,a))}};u.add("auth","/auth/"),u.add("user","/user/{0}/"),u.add("newUser","/user/"),u.add("wallets","/user/{0}/wallet/"),u.add("listWallets","/user/{0}/list/"),u.add("listWallet.statement","/statement/{0}/"),u.add("newListWallet","/list/"),u.add("wallet","/wallet/{0}/"),u.add("newWallet","/wallet/"),u.add("list.product","/list/{0}/product/{1}/"),u.add("user.addressBook","/user/{0}/address-book/"),u.add("user.creditCard","/user/{0}/credit-card/"),u.add("parserExcel","/parserexcel/"),u.add("user.importAddressBook","/user/{0}/import-address-book/"),u.add("user.addressBookShare","/user/{0}/address-book-share/"),u.add("restorePassword","/passwordrecovery/"),u.add("setImageUser","/user/{0}/image/"),u.add("user.addChild","/user/{0}/add-child/"),u.add("user.updateAddressBook","/user/{0}/address-book/{1}/"),u.add("search.organization","/search/organization/"),u.add("setCommonFund","/common-fund-wallet/"),u.add("user.commonFund","/user/{0}/common-fund-wallet/"),u.add("commonFoundWallet","/common-fund-wallet/{0}/"),u.add("closeCommonFundWallet","/close-common-fund-wallet/{0}/"),u.add("fee","/fee/"),u.add("setSchool","/school/"),u.add("closeWallet","/closewallet/"),u.add("cardContribution","/card_contribution/"),u.add("withdrawalContribution","/withdrawal_contribution/"),u.add("walletComment","/wallet/{0}/comment/"),u.add("updatePerks","/wallet/{0}/perk/{1}/"),u.add("user.notifications","/user/{0}/notification/"),u.add("notification","/checknoti/{0}/");var c=function(e,t){this.read=function(n,a){return new h(e,t,null,"GET",n,a)},this.save=function(n){return new h(e,t,n,"POST",null,null)},this.update=function(n){return new h(e,t,n,"PUT",null,null)},this.delete=function(){return new h(e,t,null,"DELETE",null,null)}},f=function(){this.code=-1,this.validationErrors={},this.handled=!1,this.message=null},h=function(o,i,d,l,u,c){var h,v=angular.copy(o),g=angular.copy(i);h=d&&"File"===d.constructor.name?d:angular.copy(d);var w=angular.copy(u),S=e.defer(),y=v.getEndPoint(g,w);if(h&&v.mapper.out&&(h=v.mapper.out(h)),v.seed)return m("Resolving "+y+" from seed"),n(function(){v.mapper.in?S.resolve(v.mapper.in(v.seed)):S.resolve(v.seed)},Math.floor(1e3*Math.random()+1e3)),S.promise;var b=[];b["Content-Type"]="application/x-www-form-urlencoded";var k=null;h&&"File"===h.constructor.name?(b["Content-Type"]=void 0,(k=new FormData).append("0",h)):h&&(k=a(h)),b["X-App-Key"]=s.appKey,r&&r.token&&(b["X-Auth-Token"]=r.token);var C={cache:!1,method:l,data:k,url:s.baseUrl+y,headers:b,transformRequest:angular.identity};return"GET"===l&&p.inCache(C.url)&&(C.cache=!0,m("Pulling "+C.url+" from cache")),c&&p.add(C.url,c),t(C).then(function(e){v.mapper.in?S.resolve(v.mapper.in(e.data.data)):S.resolve(e.data.data)},function(e){var t=new f;t.code=e.status,400===e.status?(angular.forEach(e.data.message,function(e,n){angular.forEach(e,function(e,a){t.validationErrors[n]=e})}),"function"==typeof s.error400&&(t.handled=!0,s.error400(t)),S.reject(t)):401===e.status&&"function"==typeof s.error401?(t.handled=!0,s.error401(e.data),S.reject(t)):403===e.status&&"function"==typeof s.error403?(t.handled=!0,t.message=e.data.message,s.error403(e.data),S.reject(t)):S.reject(t)}),S.promise};this.updateSession=function(e){r.firstName=e.firstName,r.lastName=e.lastName,r.birthday=e.birthday,r.taxCode=e.taxCode,localStorage.setItem(s.localStorageFile,angular.toJson(r))},this.setSession=function(e){r=e,localStorage.setItem(s.localStorageFile,angular.toJson(e))},this.session=function(t){if(void 0!==t&&t)return r;var n=e.defer();if(r)m("Session found in cache"),n.resolve(r);else{var a=localStorage.getItem(s.localStorageFile);a&&(a=angular.fromJson(a)),a&&a.id?(r=a,o.request("user",r.id).read().then(function(){m("Session found in local storage and validated in API"),n.resolve(r)},function(){m("Session found in local storage but invalidated in API"),localStorage.removeItem(s.localStorageFile),n.reject()})):(m("No session found"),n.reject())}return n.promise},this.logout=function(){var t=e.defer();return o.request("auth").delete().then(function(){r=null,localStorage.removeItem(s.localStorageFile),t.resolve()},function(e){t.reject(e)}),t.promise},this.killSession=function(){var t=e.defer();r=null,localStorage.removeItem(s.localStorageFile),t.resolve()},this.initialize=function(e){void 0===e.baseUrl&&void 0!==e.env&&"production"===e.env&&(e.baseUrl="https://api.growish.com/v1"),angular.extend(s,d,e),i=!0,m("I have been initialized with this config",s)},this.addSeed=function(e,t){var n=u.find(e);if(!n)return m("Method "+e+" is not defined."),!1;n.seed=t},this.request=function(){var e=arguments[0];if(!i)return m("You need to initialize the API client first"),!1;var t=u.find(e);if(!t)return m("Method "+e+" is not defined."),!1;for(var n=[],a=1;a<arguments.length;a++)n.push(arguments[a]);return new c(t,n)},this.authenticate=function(e,t){return o.request("auth").save({email:e,password:t})},this.addMapper=function(e,t){var n=u.find(e);return n?"function"!=typeof t.in||"function"!=typeof t.out?(m("The mapper object is not defined correctly"),!1):void(n.mapper=t):(m("Method "+e+" do not exist"),!1)};var p=new function(){var e=[],t=function(t){for(var n=0;n<e.length;n++)if(e[n].url===t)return n;return-1};this.inCache=function(n){var a=(new Date).getTime(),r=t(n);return console.table(e),r>=0&&(!(!e[r].expire||e[r].expire<=a)||(e[r].expire=null,!1))},this.add=function(n,a){var r=(new Date).getTime(),o=t(n);return o>=0?(e[o].expire=r+1e3*a,!0):(e.push({url:n,expire:r}),!0)}},m=function(e,t){"production"!==s.env&&console.log("***","GW API CLIENT:",e,"***"),t&&console.log(t)}}]);